# 中立标准方案

## 目标与原则
中立标准是跨平台共享的唯一输入规范，任何平台输出都必须由该标准映射生成。原则如下：
- 单一事实源：仓库内的中立标准是唯一真相，平台配置是派生结果
- 可验证：字段约束明确，可静态校验
- 最小充分：只包含跨平台的“并集”能力，不掺杂平台私有字段
- 可扩展：平台私有字段通过扩展区隔离，不污染标准主体

## v2.0 范围
- 仅覆盖已验证平台的 Agent/Skill 管理：OpenCode、Claude Code、Kilo Code、GitHub Copilot
- 未在 schemas/ 中声明的平台不属于 v2.0 范围

## 目录结构
标准输入目录为仓库根目录：
- agents/：Agent 标准定义
- skills/：Skill 标准定义
- schemas/：平台 schema 描述

平台输出目录由 schema 驱动生成：
- OpenCode：`.opencode/agents/`、`.opencode/skills/`
- Claude Code：`.claude/agents/`、`.claude/skills/`
- Kilo Code：`.kilocode/skills/`（含模式专用目录）
- GitHub Copilot：`.github/skills/` 与 `~/.copilot/skills/`

## 标准输入与平台输出对照表
| 标准输入 | 平台 | global 输出 | project 输出 |
| --- | --- | --- | --- |
| agents/<agent>/agent.md | OpenCode | <opencode_root>/agents/<agent>.md | .opencode/agents/<agent>.md |
| agents/<agent>/agent.md | Claude Code | <claude_root>/agents/<agent>.md | .claude/agents/<agent>.md |
| agents/<agent>/agent.md | Kilo Code | 不支持 | 不支持 |
| agents/<agent>/agent.md | GitHub Copilot | <copilot_root>/<agent>.agent.md | .github/agents/<agent>.agent.md |
| skills/<skill>/SKILL.md | OpenCode | <opencode_root>/skills/<skill>/SKILL.md | .opencode/skills/<skill>/SKILL.md |
| skills/<skill>/SKILL.md | Claude Code | <claude_root>/skills/<skill>/SKILL.md | .claude/skills/<skill>/SKILL.md |
| skills/<skill>/SKILL.md | Kilo Code | <kilo_root>/skills/<skill>/SKILL.md | .kilocode/skills/<skill>/SKILL.md |
| skills/<skill>/SKILL.md | GitHub Copilot | ~/.copilot/skills/<skill>/SKILL.md | .github/skills/<skill>/SKILL.md |

## Agent 中立标准
Agent 以 Markdown 文件承载，文件名即 agent 标识符，包含以下部分：
1) YAML frontmatter（中立字段）
2) Markdown 主体（系统提示词与说明）

建议字段：
- name（必填）：agent 名称
- description（必填）：用途描述
- mode（可选）：primary/subagent 等角色
- tools（可选）：工具访问策略（中立抽象）
- model（可选）：模型偏好（仅作为提示，不强制）

禁止字段：
- 平台专有字段直接混入标准段
- 与用户环境强绑定的绝对路径

平台私有字段策略：
- 统一挂载在 platforms.<platform_name> 下

## Skill 中立标准
Skill 为目录结构，每个 skill 目录包含 SKILL.md：
skills/<skill-name>/SKILL.md

SKILL.md 必须包含 YAML frontmatter：
- name（必填）：与目录名一致
- description（必填）
- license（可选）
- compatibility（可选）
- metadata（可选）

可附带文件（非必需）：
- scripts/
- examples/
- references/
- templates/

## 能力语义映射
中立标准只表达通用语义，平台术语由 schema 的 capabilities 负责解释与证据链接。
- agent.mode=primary：平台称谓可能是 primary agent 或 custom agent/custom mode
- agent.mode=subagent：平台称谓可能是 subagent
- instructions.project：项目级规则文件（如 CLAUDE.md 或 copilot-instructions.md）
- tools.permission：工具可用性与权限策略
- mcps：通过 MCP 配置接入外部工具
- skills.agent_skills：以 SKILL.md 为入口的技能目录

## 约束与校验规则
- name 必须符合小写字母、数字、连字符规则
- description 长度有上限
- 目录名必须与 name 完全一致
- 不允许在标准层引入平台私有文件名或路径

## 扩展与演进策略
- 标准字段只允许新增，不允许语义变更或删除
- 平台差异只允许在 platforms.<platform_name> 扩展区出现
- 标准变更必须提供迁移策略与自动化校验
- 允许通过 metadata 承载未来标准化候选字段
- 任何破坏性变更必须以新版本标准发布

## 长期稳定性保障
- 标准输入结构保持固定，平台输出可演进
- 所有平台能力缺失必须显式声明，避免隐性兜底
- 中立标准仅表达“事实与意图”，不承诺平台实现细节

## 适配与冲突处理
- 项目级定义优先于全局定义
- 平台冲突（同名覆盖）由平台规则决策，不在中立层隐藏
- 中立层只负责提供规范输入，冲突策略在 schema 层实现

## 迁移与回滚
迁移步骤：
1. 将 skills/skills/ 下的目录移动到仓库根目录 skills/
2. 确保每个 skill 的 SKILL.md 中 name 与目录名一致
3. 确保 agents/<agent>/agent.md 的 frontmatter 完整可解析

回滚策略：
1. 迁移前使用 git 或备份目录保留原结构
2. 回滚时恢复备份或重置到迁移前版本

## 参考链接
- OpenCode Skills：<https://opencode.ai/docs/skills>
- OpenCode Agents：<https://opencode.ai/docs/agents/>
- Claude Code Skills：<https://code.claude.com/docs/en/skills>
- Claude Code Subagents：<https://code.claude.com/docs/en/sub-agents>
- Kilo Code Skills：<https://kilo.ai/docs/agent-behavior/skills>
- Copilot Agent Skills：<https://code.visualstudio.com/docs/copilot/customization/agent-skills>
