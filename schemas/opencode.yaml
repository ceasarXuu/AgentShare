# OpenCode Platform Schema
# 定义如何从统一 Agent 定义生成 OpenCode 专用格式

name: opencode
display_name: OpenCode

# 目标目录检测
target_detection:
  paths:
    - ~/.config/opencode
    - ~/.opencode
    - ~/Library/Application Support/OpenCode

# 部署后是否需要重启
requires_restart: true

# 输出配置
outputs:
  # 1. Agent 定义文件
  agent_definition:
    target: agents/{agent_name}.md
    format: markdown_with_frontmatter
    frontmatter:
      - name
      - description
      - mode: platforms.opencode.mode
      - temperature: platforms.opencode.temperature
    include_body: true
    exclude_fields:
      - model  # 不包含模型配置，避免无效模型错误
    
  # 2. 主配置文件
  config:
    target: opencode.json
    format: json
    template: |
      {
        "$schema": "https://opencode.ai/config.json",
        "mcp": {mcps}
      }
    exclude_fields:
      - model
      
  # 3. Skills 目录
  skills:
    source: skills/
    target: skills/
    type: directory
    
  # 4. Workflows 目录
  workflows:
    source: workflows/
    target: workflows/
    type: directory
    
  # 5. 文档目录
  docs:
    source: docs/
    target: "{agent_name}_docs/"
    type: directory
    optional: true

# 支持的功能
features:
  - skills
  - workflows
  - mcps
  - docs
